
{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    
    <title>MakeIn | Chat</title>
    
  <link rel="icon" href="/media/logo.png" type="image/png">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="assets1/favicon.svg" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="{% static 'assets1/style.css' %}">
    <script src="{% static 'assets1/script.js' %}" defer></script>
	<script   src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>
</head>

<body class="conetent bg-secondary  bg-opacity-25">
    <header class="header">
        <nav class="header__content">
            <div class="header__buttons">
                <a href="{% url 'index' %}" class="header__home">
                    <img src="/media/logo.png" width="50" height="50" alt="MakeIn logo">
                    
                </a>
                <h3 style="font-family:'Lucida Handwriting' ">MakeIn</h3>
          
                <button class="header__theme-button" title="Toggle Theme">
                    <svg class="header__theme-button-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="var(--text-dark)" viewBox="0 0 16 16">
                        <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278zM4.858 1.311A7.269 7.269 0 0 0 1.025 7.71c0 4.02 3.279 7.276 7.319 7.276a7.316 7.316 0 0 0 5.205-2.162c-.337.042-.68.063-1.029.063-4.61 0-8.343-3.714-8.343-8.29 0-1.167.242-2.278.681-3.286z"/>
                    </svg>
                    <svg class="header__theme-button-sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="var(--text-dark)" viewBox="0 0 16 16">
                        <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
                    </svg>
                </button>
            </div>

            <form action="{% url 'search-users' %}" method="GET">
                <div class="header__search">
                    <input type="text" placeholder="Search" name="q" value="{{ request.GET.q }}">
                    <button class="btn btn-secondary btn-sm" type="submit">Search</button>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M21.669 21.6543C21.8625 21.4622 21.863 21.1494 21.6703 20.9566L17.3049 16.5913C18.7912 14.9327 19.7017 12.7525 19.7017 10.3508C19.7017 5.18819 15.5135 1 10.3508 1C5.18819 1 1 5.18819 1 10.3508C1 15.5135 5.18819 19.7017 10.3508 19.7017C12.7624 19.7017 14.9475 18.7813 16.606 17.2852L20.9739 21.653C21.1657 21.8449 21.4765 21.8454 21.669 21.6543ZM1.9843 10.3508C1.9843 5.7394 5.7394 1.9843 10.3508 1.9843C14.9623 1.9843 18.7174 5.7394 18.7174 10.3508C18.7174 14.9623 14.9623 18.7174 10.3508 18.7174C5.7394 18.7174 1.9843 14.9623 1.9843 10.3508Z" fill="#A5A5A5" stroke="#A5A5A5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </form>
            <div class="header__buttons header__buttons--mobile">
                <a href="{% url 'message' %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-chat-dots" viewBox="0 0 16 16">
                        <path  d="M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                        <path fill="var(--text-dark)" d="m2.165 15.803.02-.004c1.83-.363 2.948-.842 3.468-1.105A9.06 9.06 0 0 0 8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.437 10.437 0 0 1-.524 2.318l-.003.011a10.722 10.722 0 0 1-.244.637c-.079.186.074.394.273.362a21.673 21.673 0 0 0 .693-.125zm.8-3.108a1 1 0 0 0-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6c0 3.193-3.004 6-7 6a8.06 8.06 0 0 1-2.088-.272 1 1 0 0 0-.711.074c-.387.196-1.24.57-2.634.893a10.97 10.97 0 0 0 .398-2z"/>
                      </svg>
                </a>





                <span>
                    <a href="{% url 'show-notification' %}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-bell" viewBox="0 0 16 16">
                            <path fill="var(--text-dark)" d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2zM8 1.918l-.797.161A4.002 4.002 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4.002 4.002 0 0 0-3.203-3.92L8 1.917zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5.002 5.002 0 0 1 13 6c0 .88.32 4.2 1.22 6z"/>
                          </svg>
                    
                    </a>
                </span>
                
                <a href="">
                    <button class="profile-button">
                        <div class="profile-button__border"></div>
                        <a href="{% url 'profile' request.user %}">
                            <div class="profile-button__picture">
                                <img src="{{request.user.profile.image.url}}" alt="User Picture">
                            </div>
                        </a>
                    </button>
                </a>
            </div>

            <div class="header__buttons header__buttons--desktop">
                <a href="{% url 'newpost' %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-plus-circle-dotted" viewBox="0 0 16 16">
                        <path fill="var(--text-dark)" d="M8 0c-.176 0-.35.006-.523.017l.064.998a7.117 7.117 0 0 1 .918 0l.064-.998A8.113 8.113 0 0 0 8 0zM6.44.152c-.346.069-.684.16-1.012.27l.321.948c.287-.098.582-.177.884-.237L6.44.153zm4.132.271a7.946 7.946 0 0 0-1.011-.27l-.194.98c.302.06.597.14.884.237l.321-.947zm1.873.925a8 8 0 0 0-.906-.524l-.443.896c.275.136.54.29.793.459l.556-.831zM4.46.824c-.314.155-.616.33-.905.524l.556.83a7.07 7.07 0 0 1 .793-.458L4.46.824zM2.725 1.985c-.262.23-.51.478-.74.74l.752.66c.202-.23.418-.446.648-.648l-.66-.752zm11.29.74a8.058 8.058 0 0 0-.74-.74l-.66.752c.23.202.447.418.648.648l.752-.66zm1.161 1.735a7.98 7.98 0 0 0-.524-.905l-.83.556c.169.253.322.518.458.793l.896-.443zM1.348 3.555c-.194.289-.37.591-.524.906l.896.443c.136-.275.29-.54.459-.793l-.831-.556zM.423 5.428a7.945 7.945 0 0 0-.27 1.011l.98.194c.06-.302.14-.597.237-.884l-.947-.321zM15.848 6.44a7.943 7.943 0 0 0-.27-1.012l-.948.321c.098.287.177.582.237.884l.98-.194zM.017 7.477a8.113 8.113 0 0 0 0 1.046l.998-.064a7.117 7.117 0 0 1 0-.918l-.998-.064zM16 8a8.1 8.1 0 0 0-.017-.523l-.998.064a7.11 7.11 0 0 1 0 .918l.998.064A8.1 8.1 0 0 0 16 8zM.152 9.56c.069.346.16.684.27 1.012l.948-.321a6.944 6.944 0 0 1-.237-.884l-.98.194zm15.425 1.012c.112-.328.202-.666.27-1.011l-.98-.194c-.06.302-.14.597-.237.884l.947.321zM.824 11.54a8 8 0 0 0 .524.905l.83-.556a6.999 6.999 0 0 1-.458-.793l-.896.443zm13.828.905c.194-.289.37-.591.524-.906l-.896-.443c-.136.275-.29.54-.459.793l.831.556zm-12.667.83c.23.262.478.51.74.74l.66-.752a7.047 7.047 0 0 1-.648-.648l-.752.66zm11.29.74c.262-.23.51-.478.74-.74l-.752-.66c-.201.23-.418.447-.648.648l.66.752zm-1.735 1.161c.314-.155.616-.33.905-.524l-.556-.83a7.07 7.07 0 0 1-.793.458l.443.896zm-7.985-.524c.289.194.591.37.906.524l.443-.896a6.998 6.998 0 0 1-.793-.459l-.556.831zm1.873.925c.328.112.666.202 1.011.27l.194-.98a6.953 6.953 0 0 1-.884-.237l-.321.947zm4.132.271a7.944 7.944 0 0 0 1.012-.27l-.321-.948a6.954 6.954 0 0 1-.884.237l.194.98zm-2.083.135a8.1 8.1 0 0 0 1.046 0l-.064-.998a7.11 7.11 0 0 1-.918 0l-.064.998zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/>
                      </svg>
                </a>
                <a href="{% url 'index' %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
                        <path fill="var(--text-dark)" d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5ZM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5 5 5Z"/>
                      </svg>
                </a>
                <a href="{% url 'message' %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-chat-dots" viewBox="0 0 16 16">
                        <path d="M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                        <path fill="var(--text-dark)" d="m2.165 15.803.02-.004c1.83-.363 2.948-.842 3.468-1.105A9.06 9.06 0 0 0 8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.437 10.437 0 0 1-.524 2.318l-.003.011a10.722 10.722 0 0 1-.244.637c-.079.186.074.394.273.362a21.673 21.673 0 0 0 .693-.125zm.8-3.108a1 1 0 0 0-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6c0 3.193-3.004 6-7 6a8.06 8.06 0 0 1-2.088-.272 1 1 0 0 0-.711.074c-.387.196-1.24.57-2.634.893a10.97 10.97 0 0 0 .398-2z"/>
                      </svg>
                </a>





                <span>
                    <a href="{% url 'show-notification' %}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-bell" viewBox="0 0 16 16">
                            <path fill="var(--text-dark)" d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2zM8 1.918l-.797.161A4.002 4.002 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4.002 4.002 0 0 0-3.203-3.92L8 1.917zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5.002 5.002 0 0 1 13 6c0 .88.32 4.2 1.22 6z"/>
                          </svg>
                    
                    </a>
                </span>
                
                <a href="">
                    <button class="profile-button">
                        <div class="profile-button__border"></div>
                        <a href="{% url 'profile' request.user %}">
                            <div class="profile-button__picture">
                                <img src="{{request.user.profile.image.url}}" alt="User Picture">
                            </div>
                        </a>
                    </button>
                </a>
            </div>
        </nav>
    </header>






	<head>
	
		<style>
			body{margin-top:20px;}
	
	.chat-online {
		color: #34ce57
	}
	
	.chat-offline {
		color: #e4606d
	}
	
	.chat-messages {
		display: flex;
		flex-direction: column;
		max-height: 650px;
		overflow-y: scroll
	}
	
	.chat-message-left,
	.chat-message-right {
		display: flex;
		flex-shrink: 0
	}
	
	.chat-message-left {
		margin-right: auto
	}
	
	.chat-message-right {
		flex-direction: row-reverse;
		margin-left: auto
	}
	.py-3 {
		padding-top: 1rem!important;
		padding-bottom: 1rem!important;
	}
	.px-4 {
		padding-right: 1.5rem!important;
		padding-left: 1.5rem!important;
	}
	.flex-grow-0 {
		flex-grow: 0!important;
	}
	.border-top {
		border-top: 1px solid #dee2e6!important;
	}
		</style>
	</head>
	<br><br>
	<main >
		<div class="container p-0 ">
	
			<h1 class="h3 text-center">MESSAGES</h1>
	
			<div class="card">
				<div class="row g-0">
					<div class="col-12 col-lg-12 col-xl-3 border-right chat-messages" >
	
						<div class="px-4 d-none d-md-block">
							<div class="d-flex align-items-center">
								<div class="flex-grow-1">
								</div>
							</div>
						</div>
						{% for message in messages %}
						<a href="{% url 'directs' message.user.username %}" class="list-group-item list-group-item-action border-0 {% if active_direct == message.user.username %}active{% endif %}">
							<div class="badge bg-success float-right"></div>
							<div class="d-flex align-items-start pb-2">
								
									<img src="{{ message.user.profile.image.url }}" class="rounded-circle mr-1" alt="img" width="40" height="40">
								
								<div class="flex-grow-1 ml-6">
									<b>{{message.user.profile.first_name}} {{message.user.profile.last_name}}</b>
									<div class="small"><span class="fas fa-circle chat-online"></span> @{{message.user.username}}</div>
								</div>
								{% if active_direct == message.user.username %}
								{% if e_direct is 1 %}
								<img src="/media/happy.png" class="rounded-circle mr-1" alt="img" width="60" height="60">
								{% elif e_direct is 2 %}
								<img src="/media/angry.png" class="rounded-circle mr-1" alt="img" width="60" height="60">
								{% elif e_direct is 3 %}
								<img src="/media/surprise.png" class="rounded-circle mr-1" alt="img" width="60" height="60">
								{% elif e_direct is 4 %}
								<img src="/media/sad.png" class="rounded-circle mr-1" alt="img" width="60" height="60">
								{% elif e_direct is 5 %}
								<img src="/media/fear.png" class="rounded-circle mr-1" alt="img" width="60" height="60">
								{% else %}
								<img src="/media/neutral.png" class="rounded-circle mr-1" alt="img" width="60" height="60">
								{% endif %}
								{% endif %}
							</div>
						</a>
						{% endfor %}
	
						<hr class="d-block d-lg-none mt-1 mb-0">
					</div>
					<div class="col-12 col-lg-7 col-xl-9">
						<div class="py-2 px-4 border-bottom d-none d-lg-block">
							<div class="d-flex align-items-center py-1">
								<!-- <div class="position-relative">
									<img src="https://bootdey.com/img/Content/avatar/avatar3.png" class="rounded-circle mr-1" alt="Sharon Lessman" width="40" height="40">
								</div>
								<div class="flex-grow-1 pl-3">
									<strong>Sharon Lessman</strong>
									<div class="text-muted small"><em>Typing...</em></div>
								</div> -->
								<div><img src="{{ to_user.profile.image.url }}" class="rounded-circle mr-1" alt="img" width="40" height="40">
									<span style="font-weight:bold;font-size:30px">@{{user}}  </span>
									
	
								</div>
							</div>
						</div>
									

									
						<div class="position-relative ">
							<div class="chat-messages p-4">

								<div id="display">

								</div>
								

								
	
							</div>
						</div>

						<script>
							$(document).ready(function(){
							
							setInterval(function(){
								$.ajax({
									type: 'GET',
									url : "/message/getMessages/{{user}}/",
									success: function(response){
										console.log(response);
										$("#display").empty();
										for (var key in response.directs)
										{	
											if (response.directs[key].sender_id == response.directs[key].reciepient_id)
												var temp ='<div class="chat-message-left pb-2"><span class="border border-secondary rounded bg-primary"><div><a href=""></a></div><div class="flex-shrink-1 bg-light rounded py-2 px-3 ml-3">'+ response.directs[key].body +'</div><span class="ml-3"></span><div class="text-muted small text-nowrap mt-0 ml-6 " style="font-size:10px; color: rgba(180, 180, 180, 0);"><p style="font-size:10px; color: white;">'+response.directs[key].date.slice(0,10)+'</p></div></span></div>';
											else
												var temp ='<div class="chat-message-right pb-2"><span class="border border-secondary rounded bg-secondary"><div><a href=""></a></div><div class="flex-shrink-1 bg-light rounded py-2 px-3 ml-3">'+ response.directs[key].body +'</div><span class="ml-3"></span><div class="text-muted small text-nowrap mt-0 ml-6  mb-2" style="font-size:10px; color: rgba(180, 180, 180, 0);"><p style="font-size:10px; color: white;">'+response.directs[key].date.slice(0,10)+'</p></div></span></div>';
											$("#display").append(temp);
										}
									},
									error: function(response){
										alert('An error occured')
									}
								});
							},1000);
							})
							</script>

							<div class="flex-grow-0 py-3 px-4 border-top">
								<form id="post-form">
									{% csrf_token %}
									<div class="input-group">
										{% if e_direct is 1 %}
										<img src="/media/happy.png" class="rounded-circle mr-1" alt="img" width="40" height="40">
										{% elif e_direct is 2 %}
										<img src="/media/angry.png" class="rounded-circle mr-1" alt="img" width="40" height="40">
										{% elif e_direct is 3 %}
										<img src="/media/surprise.png" class="rounded-circle mr-1" alt="img" width="40" height="40">
										{% elif e_direct is 4 %}
										<img src="/media/sad.png" class="rounded-circle mr-1" alt="img" width="40" height="40">
										{% elif e_direct is 5 %}
										<img src="/media/fear.png" class="rounded-circle mr-1" alt="img" width="40" height="40">
										{% else %}
										<img src="/media/neutral.png" class="rounded-circle mr-1" alt="img" width="40" height="40">
										{% endif %}
										<input type="hidden" name="to_user" id="username" value="{{active_direct}}">
										<input name="body" type="text" id="message" class="form-control" placeholder="Type your message">
										<button class="btn btn-primary" type="submit">Send</button>
									</div>
								</form>
								
							</div>
							
	
					</div>
				</div>
			</div>
		</div>
	</main>

	




    
</body>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>

<script type="text/javascript">
	$(document).on('submit','#post-form',function(e){
	  e.preventDefault();
  
	  $.ajax({
		type:'POST',
		url:'/message/send/',
		data:{
			to_user:$('#username').val(),
			body:$('#message').val(),
		  csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
		},
		success: function(data){
		   //alert(data)
		}
	  });
	  document.getElementById('message').value = ''
	});
  </script>
</html>
